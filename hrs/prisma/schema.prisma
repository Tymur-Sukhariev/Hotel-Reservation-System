generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id           Int                   @id @default(autoincrement())
  firstName    String
  lastName     String
  email        String                @unique
  passwordHash String
  role         Role                  @default(USER)
  bookings     Bookings[]
  resetTokens  ResetPasswordTokens[]
  sessions     Sessions[]
  Reviews      Reviews[]
}

model Sessions {
  id        Int      @id @default(autoincrement())
  token     String   @unique @default(cuid())
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Bookings {
  id            Int      @id @default(autoincrement())
  roomId        Int
  userId        Int
  checkIn       DateTime
  checkOut      DateTime
  totalPrice    Float
  bookingNumber Int      @unique
  room          Rooms    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user          Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Rooms {
  id         Int         @id
  priceId    Int
  guests     Int
  typeId     Int
  booked     Int         @default(0)
  bookings   Bookings[]
  facilities Facilities?
  price      RoomPrices  @relation(fields: [priceId], references: [id], onDelete: Cascade)
  type       Types       @relation(fields: [typeId], references: [id], onDelete: Cascade)
}

model Types {
  id          Int          @id @default(autoincrement())
  type        String
  comfort     String
  previewText String
  description String
  images      RoomImages[]
  rooms       Rooms[]
}

model Facilities {
  id     Int     @id @default(autoincrement())
  roomId Int     @unique
  tv     Boolean
  ac     Boolean
  bath   Boolean
  room   Rooms   @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model RoomImages {
  id       Int    @id @default(autoincrement())
  typeId   Int?
  imageUrl String
  order    Int
  type     Types? @relation(fields: [typeId], references: [id], onDelete: Cascade)
}

model RoomPrices {
  id    Int     @id @default(autoincrement())
  price Float
  rooms Rooms[]
}

model ResetPasswordTokens {
  id        Int      @id @default(autoincrement())
  userId    Int
  token     String   @unique @default(cuid())
  createdAt DateTime @default(now())
  user      Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Reviews {
  id        Int      @id @default(autoincrement())
  rate      Int
  text      String
  createdAt DateTime @default(now())

  user   Users @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int
}

enum Role {
  ADMIN
  USER
}
